# name: deploy-android-appcenter
# on: [push]
# jobs:
#   build:
#     name: Create Android Build
#     needs: version
#     runs-on: macos-latest
#     steps:
#       - uses: actions/checkout@v3
#       # 2   
#       - name: Get version.txt
#         uses: actions/download-artifact@v2
#         with:
#           name: gitversion
#       # 3
#       - name: Create new file without newline char from version.txt
#         run: tr -d '\n' < version.txt > version1.txt
#       # 4
#       - name: Read version
#         id: version
#         uses: juliangruber/read-file-action@v1
#         with:
#           path: version1.txt
#       # 5
#       - name: Update version in YAML
#         run: sed -i 's/99.99.99+99/${{ steps.version.outputs.content }}+${{ github.run_number }}/g' pubspec.yaml
#       # 6
#       - name: Download Android keystore
#         id: android_keystore
#         uses: timheuer/base64-to-file@v1.0.3
#         with:
#           fileName: upload-keystore.jks
#           encodedString: ${{ secrets.KEYSTORE_BASE64 }}
#       # 7
#       - name: Create key.properties
#         run: |
#           echo "storeFile=${{ steps.android_keystore.outputs.filePath }}" > android/key.properties
#           echo "storePassword=${{ secrets.STORE_PASSWORD }}" >> android/key.properties
#           echo "keyPassword=${{ secrets.KEY_PASSWORD }}" >> android/key.properties
#           echo "keyAlias=${{ secrets.KEY_ALIAS }}" >> android/key.properties
      

#       - uses: actions/checkout@v1
#       - name: set up JDK 11
#         uses: actions/setup-java@v1
#         with:
#           java-version: 11
#       - name: Setup Flutter
#         uses: subosito/flutter-action@v1
#         with:
#           flutter-version: "3.3.10"
#       - name: Pub Get Packages
#         run: flutter pub get
#       - name: Build apk release
#         run: flutter build apk --release
#       - name: upload apk to App Center
#         uses: wzieba/AppCenter-Github-Action@v1
      
#         with:
#           appName: tiktok_clone_android
#           token: 53540ce96a4fad0d4511636629a99d76e557ec4f
#           group: public
#           file: build/app/outputs/flutter-apk/app-release.apk
#           notifyTesters: true
#           debug: false
        
name: Build Release App Bundle

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Decode Keystore
        id: decode_keystore
        uses: timheuer/base64-to-file@v1
        with:
          fileName: 'keystore/your_signing_keystore.jks'
          encodedString: ${{ secrets.KEYSTORE }}
      - uses: actions/checkout@v2
      - name: set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Make gradlew executable
        run: chmod +x ./gradlew
      - name: build prod
        run: ./gradlew app:bundleRelease
        env:
          SIGNING_KEY_ALIAS: ${{ secrets.SIGNING_KEY_ALIAS }}
          SIGNING_KEY_PASSWORD: ${{ secrets.SIGNING_KEY_PASSWORD }}
          SIGNING_STORE_PASSWORD: ${{ secrets.SIGNING_STORE_PASSWORD }}
      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: Build Artifacts
          path: app/build/outputs/